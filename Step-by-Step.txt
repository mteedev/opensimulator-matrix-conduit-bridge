Three Steps to create/link Matrix room
Questions? contact Fiona Sweet <fiona@pobox.holoneon.com>



Step 1: Create the group in OpenSim (in viewer)
    Do this in Firestorm (or any viewer with Groups UI):
    Communicate ... Groups
    Create Group

    Set:
        Name: (your group name)
        Enrollment: your choice
        Founder: you
    Create it.

*note these: (example)
Group Name: Matrixilacious    
Group UUID: 7ab108be-d669-49a4-9aed-ea167c37ecd9
Founder: Fiona Sweet 
Founder UUID: 69696969-6969-4666-9666-696969696969


Step 2: Enable Matrix bridge for that group (manual "linking")

FOUNDER_UUID is your OpenSim UUID

curl -X POST http://10.99.0.5:9010/admin/bridge/enable \
  -H "Content-Type: application/json" \
  -H "X-Bridge-Secret: OS_BRIDGE_SECRET" \
  -d '{
        "GroupUuid": "GROUP_UUID",
        "GroupName": "GROUP_NAME",
        "FounderAvatarUuid": "FOUNDER_UUID"
      }'

should return Matrix group id

    *example: {"roomId":"!ACXHzjrNauNhQcEEfV:matrix.holoneon.com"}



Step 3: Join the room on Matrix side (admin-style)

    Your room should be invite-only. That means you must be invited.

    (!ROOM_ID is the id returned from step #2)

Invite with the bridge bot:

curl -X POST \
  -H "Authorization: Bearer AS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"user_id":"@fiona:matrix.holoneon.com"}' \
  'http://127.0.0.1:8008/_matrix/client/v3/rooms/!ROOM_ID/invite'


Or, force-invite with Matrix admin account
(on a new empty room you might need to do this for the *first member* if the bridge bot fails)
you need your synapse/Matrix api admin token

curl -X POST \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"user_id":"@fiona:matrix.holoneon.com"}' \
  'http://127.0.0.1:8008/_synapse/admin/v1/join/!ROOM_ID'




Resync (if you want puppets/roles/avatars refreshed)
if you promote a user to officer, or demote a user, or want to update user icons this is a maintenance step. It won't disrupt your room.
GROUP_UUID is your OpenSim group uuid

curl -X POST http://10.99.0.5:9010/admin/bridge/resync \
  -H "Content-Type: application/json" \
  -H "X-Bridge-Secret: OS_BRIDGE_SECRET" \
  -d '{"GroupUuid":"GROUP_UUID"}'



Note: Matrix client (such as Element) may show warning about unencrypted.. this is because chat in OpenSim is _not_ encrypted and does not provide E2E.


Example invite:

https://gyazo.com/6569d0df0ee25deada026b23c23c523d

Example Matrix room:

https://gyazo.com/417164440e4e00ff166a5fcc44018338

